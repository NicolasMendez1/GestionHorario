
CREATE OR REPLACE FUNCTION GH_GENERA_CORREO(
    NOMBRE_USUARIO_F VARCHAR2,
    APELLIDO_PATERNO_USUARIO_F VARCHAR2,
    APELLIDO_MATERNO_USUARIO_F VARCHAR2
)
RETURN VARCHAR2
IS
    NICK_F VARCHAR2(50) := '';
    CORREO_F VARCHAR2(50) := '';
    CONTADOR NUMBER := 0;
BEGIN
    NICK_F := SUBSTR(NOMBRE_USUARIO_F,1,1)||APELLIDO_PATERNO_USUARIO_F;

    SELECT COUNT(*) INTO CONTADOR
    FROM GH_USUARIO
    WHERE NICK_F = CONCAT(SUBSTR(NOMBRE,1,1),APELLIDO_PATERNO);

    IF(CONTADOR = 0)THEN
        CORREO_F := CONCAT(NICK_F,'@UCM.CL');
    ELSE
        CORREO_F := CONCAT(NICK_F,CONCAT(CONTADOR,'@UCM.CL'));
    END IF;

    RETURN CORREO_F;    
END;

